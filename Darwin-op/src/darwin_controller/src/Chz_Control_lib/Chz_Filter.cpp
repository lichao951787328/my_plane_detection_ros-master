#include "Chz_Filter.h"

void Chz::LowPassFilter5::Reset(double wn1)
{
	Wn = wn1;
	if (abs(Wn - 45.0) < eps)
		a[0] = 1.0000000000000000, a[1] = 3.9845431196123364, a[2] = 6.4348670902758691, a[3] = 5.2536151703522691, a[4] = 2.1651329097241327, a[5] = 0.3599282450635561,
		b[0] = 0.5999402042196301, b[1] = 2.9997010210981507, b[2] = 5.9994020421963015, b[3] = 5.9994020421963015, b[4] = 2.9997010210981507, b[5] = 0.5999402042196301;
	else if (abs(Wn - 40.0) < eps)
		a[0] = 1.0000000000000000, a[1] = 2.9754221097456823, a[2] = 3.8060181193204090, a[3] = 2.5452528683304649, a[4] = 0.8811300754378356, a[5] = 0.1254306221553555,
		b[0] = 0.3541641810934296, b[1] = 1.7708209054671480, b[2] = 3.5416418109342960, b[3] = 3.5416418109342960, b[4] = 1.7708209054671480, b[5] = 0.3541641810934296;
	else if (abs(Wn - 35.0) < eps)
		a[0] = 1.0000000000000000, a[1] = 1.9759016164414653, a[2] = 2.0134730260003066, a[3] = 1.1026179777777687, a[4] = 0.3276183340001565, a[5] = 0.0407094896166652,
		b[0] = 0.2018850138698863, b[1] = 1.0094250693494318, b[2] = 2.0188501386988635, b[3] = 2.0188501386988635, b[4] = 1.0094250693494318, b[5] = 0.2018850138698863;
	else if (abs(Wn - 30.0) < eps)
		a[0] = 1.0000000000000000, a[1] = 0.9853252392792378, a[2] = 0.9738493318367640, a[3] = 0.3863565586484486, a[4] = 0.1111638405783420, a[5] = 0.0112635124565659,
		b[0] = 0.1083737025874800, b[1] = 0.5418685129373998, b[2] = 1.0837370258747996, b[3] = 1.0837370258747996, b[4] = 0.5418685129373998, b[5] = 0.1083737025874800;
	else if (abs(Wn - 25.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -0.0000000000000005, a[2] = 0.6334368540005050, a[3] = -0.0000000000000002, a[4] = 0.0557280900008412, a[5] = -0.0000000000000000,
		b[0] = 0.0527864045000420, b[1] = 0.2639320225002102, b[2] = 0.5278640450004204, b[3] = 0.5278640450004204, b[4] = 0.2639320225002102, b[5] = 0.0527864045000420;
	else if (abs(Wn - 20.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -0.9853252392792385, a[2] = 0.9738493318367644, a[3] = -0.3863565586484489, a[4] = 0.1111638405783419, a[5] = -0.0112635124565659,
		b[0] = 0.0219396206884642, b[1] = 0.1096981034423208, b[2] = 0.2193962068846416, b[3] = 0.2193962068846416, b[4] = 0.1096981034423208, b[5] = 0.0219396206884642;
	else if (abs(Wn - 15.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -1.9759016164414662, a[2] = 2.0134730260003071, a[3] = -1.1026179777777692, a[4] = 0.3276183340001565, a[5] = -0.0407094896166652,
		b[0] = 0.0069331961301426, b[1] = 0.0346659806507130, b[2] = 0.0693319613014260, b[3] = 0.0693319613014260, b[4] = 0.0346659806507130, b[5] = 0.0069331961301426;
	else if (abs(Wn - 10.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -2.9754221097456828, a[2] = 3.8060181193204095, a[3] = -2.5452528683304654, a[4] = 0.8811300754378359, a[5] = -0.1254306221553556,
		b[0] = 0.0012825810789607, b[1] = 0.0064129053948034, b[2] = 0.0128258107896068, b[3] = 0.0128258107896068, b[4] = 0.0064129053948034, b[5] = 0.0012825810789607;
	else if (abs(Wn - 5.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -3.9845431196123373, a[2] = 6.4348670902758709, a[3] = -5.2536151703522727, a[4] = 2.1651329097241345, a[5] = -0.3599282450635565,
		b[0] = 0.0000597957803700, b[1] = 0.0002989789018498, b[2] = 0.0005979578036996, b[3] = 0.0005979578036996, b[4] = 0.0002989789018498, b[5] = 0.0000597957803700;
	else if (abs(Wn - 3.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -4.3902761942608475, a[2] = 7.7428695408010331, a[3] = -6.8543493508959141, a[4] = 3.0446853091802564, a[5] = -0.5427513749334651,
		b[0] = 0.0000055603090957, b[1] = 0.0000278015454785, b[2] = 0.0000556030909571, b[3] = 0.0000556030909571, b[4] = 0.0000278015454785, b[5] = 0.0000055603090957;
	else if (abs(Wn - 2.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -4.5934213998076885, a[2] = 8.4551152235101341, a[3] = -7.7949183180444486, a[4] = 3.5989027680539145, a[5] = -0.6656525381713615,
		b[0] = 0.0000008042356422, b[1] = 0.0000040211782110, b[2] = 0.0000080423564219, b[3] = 0.0000080423564219, b[4] = 0.0000040211782110, b[5] = 0.0000008042356422;
	else if (abs(Wn - 1.0) < eps)
		a[0] = 1.0000000000000000, a[1] = -4.7966815998178074, a[2] = 9.2072423750920098, a[3] = -8.8403696825009916, a[4] = 4.2457864732899200, a[5] = -0.8159766800242780,
		b[0] = 0.0000000276887142, b[1] = 0.0000001384435708, b[2] = 0.0000002768871415, b[3] = 0.0000002768871415, b[4] = 0.0000001384435708, b[5] = 0.0000000276887142;
	else if(abs(Wn - 0.5) < eps)
		a[0] = 1.0000000000000000, a[1] = -4.8983371457115998, a[2] = 9.5984970908055978, a[3] = -9.4053079891957339, a[4] = 4.6084763585369064, a[5] = -0.9033282853379997,
		b[0] = 0.0000000009092866, b[1] = 0.0000000045464330, b[2] = 0.0000000090928659, b[3] = 0.0000000090928659, b[4] = 0.0000000045464330, b[5] = 0.0000000009092866;
	else if (abs(Wn - 0.2) < eps) // 1Hz for Period = 4ms
		a[0] = 1.0000000000000000, a[1] = -4.9593344485332675, a[2] = 9.8381634112733352, a[3] = -9.7584732019704656, a[4] = 4.8397940440985572, a[5] = -0.9601498045610809,
		b[0] = 0.0000000000095962, b[1] = 0.0000000000479810, b[2] = 0.0000000000959620, b[3] = 0.0000000000959620, b[4] = 0.0000000000479810, b[5] = 0.0000000000095962;
	else
		a[0] = 1.0000000000000000, a[1] = -4.9999999997966729, a[2] = 9.9999999991866897, a[3] = -9.9999999987800336, a[4] = 4.9999999991866897, a[5] = -0.9999999997966724,
		b[0] = 0.0000000000000000, b[1] = 0.0000000000000001, b[2] = 0.0000000000000001, b[3] = 0.0000000000000001, b[4] = 0.0000000000000001, b[5] = 0.0000000000000000;
}

void Chz::LowPassFilter5::Init(double xin1)
{
	ChzF(i, 0, n) xin[i] = xin1, xout[i] = xin1;
}

void Chz::LowPassFilter5::Update(double xinnew)
{
	ChzF(i, 0, n - 1) xin[i] = xin[i + 1];
	xin[n] = xinnew;
	ChzF(i, 0, n - 1) xout[i] = xout[i + 1];
	xout[n] = 0.0;
	ChzF(i, 0, n) xout[n] += xin[i] * b[n - i];
	ChzF(i, 0, n - 1) xout[n] -= xout[i] * a[n - i];
	xout[n] /= a[0];
}

void Chz::LowPassFilter5::GetVal(double& xnow)
{
	xnow = xout[n];
}

void Chz::LowPassFilter5::GetVal(double& xnow, double& xlast)
{
	xnow = xout[n]; xlast = xout[n - 1];
}
